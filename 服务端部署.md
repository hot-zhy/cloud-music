### 服务器环境

CentOS 7.9

JDK 1.7

MySQL 5.7

Tomcat 8.5.84

Nginx 1.12.2

宝塔面板 7.9.63

### 项目部署

项目部署在宝塔面板中完成

[项目部署]: https://www.bt.cn/new/download.html

##### MySQL安装部署

1. 进入云服务器宝塔面板，点击“数据库”--“添加数据库”，导入music.sql文件。

   > 端口：3306
   >
   > 数据库名：cloud
   >
   > 账号：root
   >
   > 密码：123456

2. 在终端输入`sudo mysql`命令启动MySQL服务，并检查cloud数据及其表结构库是否存在及。

3. 防火墙开启3306端口：

   ````bash
   # 先查看防火墙的状态，若是开启的，则继续向下
   systemctl status firewalld
   # 查看防火墙控制的端口，看3306是否开启
   firewall-cmd --list-all
   # 若没有开启，则使用以下命令开启
   sudo firewall-cmd --zone=public --add-port=3306/tcp --permanent
   # 然后重载防火墙
   sudo firewall-cmd --reload
   ````

4. 在本机Navicat导入远程数据库连接，检查连接。

##### Tomcat安装部署

1. 配置JDK环境变量，在JDK配置文件profile中加入如下，并保存。

   ```bash
   JAVA_HOME=/java_source/jdk1.8.0_231(jdk安装路径)
                PATH=$JAVA_HOME/bin:$PATH
                CLASSPATH=$JAVA_HOME/jre/lib/ext:$JAVA_HOME/lib/tools.jar
                export PATH JAVA_HOME CLASSPATH
   
   ```

2. 执行`source /etc/profile`命令使修改生效。

3. 防火墙开启80和8080端口（步骤同上）。

4. 在服务器bin目录下执行`./startup.sh`命令启动tomcat服务。

5. 在云服务器官网的控制台放行8080端口。

6. 在本机浏览器输入"云服务器公网ip:8080"访问。若出现tomcat默认页即成功。

##### Nginx安装部署

1. 安装Nginx并编译安装。

2. 打开`/usr/local/nginx/conf`目录下的nginx.conf文件，在http部分加入新的访问规则,实现9000端口访问服务器静态资源：

   ```xml
       server {
           listen       9000;
           server_name  localhost;
   
           #charset koi8-r;
   
           #access_log  logs/host.access.log  main;
   
           # location / {
           #     root   html;
           #     index  index.html index.htm;
           # }
           
           location /{
               alias /home/android/;
               autoindex on;
           }
   
           #error_page  404              /404.html;
   
           # redirect server error pages to the static page /50x.html
           #
           error_page   500 502 503 504  /50x.html;
           location = /50x.html {
               root   html;
           }
   }
   ```

3. 输入`./nginx`或`./nginx -s reload`重启nginx服务。

4. 防火墙打开9000端口（同上）。

5. 在云服务器官网的控制台放行9000端口。

6. 本机浏览器输入"服务器ip:9000/songs/不语.mp3"、"服务器ip:9000/img/avatarImages/user.jpg"进行测试。

##### 后台应用部署

1. 执行如下两条命令创建项目目录。

   ```bash
   cd /home
   mkdir android
   ```

2. 使用宝塔面板上传服务器静态资源（本地歌曲、默认头像等）。

3. 上传项目的jar包"music-server-0.0.1-SNAPSHOT"。

4. 在该项目目录下打开终端，输入nohup命令启动服务器，将输出日志存放在同级目录下的nohup.out文件中。

   ```bash
   nohup java -jar music-server-0.0.1-SNAPSHOT.jar &
   ```

5. 查看nohup.out文件，检查服务是否正常运行。

6. 在本机Postman进行访问测试，后台成功访问则项目成功启动。





> 参考链接：
>
> Springboot项目部署 https://www.jb51.net/article/216616.htm
>
> CentOS7安装Nginx https://www.likecs.com/show-522774.html
>
> MySQL远程连接解决方案 https://blog.csdn.net/qq_39162487/article/details/121456746







